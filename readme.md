# AIç”Ÿå›¾å¹³å° - å®Œæ•´æ”¯ä»˜åŠŸèƒ½å®ç°

## ğŸ¯ é¡¹ç›®ç®€ä»‹

AIç”Ÿå›¾å¹³å°æ˜¯ä¸€ä¸ªåŸºäºDjangoçš„ç°ä»£åŒ–Webåº”ç”¨ï¼Œé›†æˆäº†æ”¯ä»˜å®æ”¯ä»˜åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·ç§¯åˆ†å……å€¼å’ŒAIå›¾åƒç”ŸæˆæœåŠ¡ã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½
- ğŸ‘¤ **ç”¨æˆ·ç³»ç»Ÿ**ï¼šæ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·ä¸­å¿ƒ
- ğŸ’° **æ”¯ä»˜ç³»ç»Ÿ**ï¼šæ”¯ä»˜å®æ‰«ç æ”¯ä»˜ã€ç½‘é¡µæ”¯ä»˜
- ğŸ¨ **AIç”Ÿå›¾**ï¼šåŸºäºç§¯åˆ†çš„å›¾åƒç”ŸæˆæœåŠ¡
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒPCå’Œç§»åŠ¨ç«¯

---

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Django 4.x** - Webæ¡†æ¶
- **Python 3.x** - ç¼–ç¨‹è¯­è¨€
- **SQLite/MySQL** - æ•°æ®åº“
- **python-alipay-sdk** - æ”¯ä»˜å®SDK

### å‰ç«¯æŠ€æœ¯
- **HTML5/CSS3** - é¡µé¢ç»“æ„
- **JavaScript/jQuery** - äº¤äº’é€»è¾‘
- **Bootstrap** - UIæ¡†æ¶
- **qrcodejs** - äºŒç»´ç ç”Ÿæˆ

### æ”¯ä»˜é›†æˆ
- **æ”¯ä»˜å®å½“é¢ä»˜** - æ‰«ç æ”¯ä»˜
- **æ”¯ä»˜å®ç½‘é¡µæ”¯ä»˜** - ç”µè„‘ç«¯æ”¯ä»˜
- **æ²™ç®±ç¯å¢ƒ** - å¼€å‘æµ‹è¯•
- **ç”Ÿäº§ç¯å¢ƒ** - æ­£å¼éƒ¨ç½²

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
GoodShop/
â”œâ”€â”€ GoodShop/                 # é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ settings.py          # é¡¹ç›®è®¾ç½®
â”‚   â”œâ”€â”€ urls.py             # ä¸»è·¯ç”±
â”‚   â””â”€â”€ wsgi.py             # WSGIé…ç½®
â”œâ”€â”€ userapp/                 # ç”¨æˆ·åº”ç”¨
â”‚   â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ views.py            # è§†å›¾å‡½æ•°
â”‚   â”œâ”€â”€ urls.py             # åº”ç”¨è·¯ç”±
â”‚   â”œâ”€â”€ utils/              # å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ alipay_utils.py # æ”¯ä»˜å®å·¥å…·
â”‚   â””â”€â”€ templates/          # æ¨¡æ¿æ–‡ä»¶
â”‚       â”œâ”€â”€ login.html      # ç™»å½•é¡µé¢
â”‚       â”œâ”€â”€ register.html   # æ³¨å†Œé¡µé¢
â”‚       â”œâ”€â”€ center.html     # ç”¨æˆ·ä¸­å¿ƒ
â”‚       â””â”€â”€ recharge.html   # å……å€¼é¡µé¢
â”œâ”€â”€ templates/              # å…¨å±€æ¨¡æ¿
â”‚   â””â”€â”€ layout.html         # åŸºç¡€å¸ƒå±€
â”œâ”€â”€ static/                 # é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ css/               # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/                # JavaScriptæ–‡ä»¶
â”‚   â””â”€â”€ images/            # å›¾ç‰‡èµ„æº
â”œâ”€â”€ keys/                   # å¯†é’¥æ–‡ä»¶
â”‚   â”œâ”€â”€ my_private_key.txt # åº”ç”¨ç§é’¥
â”‚   â””â”€â”€ alipay_public_key.txt # æ”¯ä»˜å®å…¬é’¥
â””â”€â”€ media/                  # åª’ä½“æ–‡ä»¶
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd GoodShop

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®è®¾ç½®

#### æ”¯ä»˜å®é…ç½®
åœ¨ `GoodShop/settings.py` ä¸­é…ç½®æ”¯ä»˜å®å‚æ•°ï¼š

```python
# æ²™ç®±ç¯å¢ƒé…ç½®
SANDBOX_ALIPAY = {
    "appid": "9021000149644414",  # ä½ çš„æ²™ç®±APPID
    "gateway": "https://openapi.alipaydev.com/gateway.do",
    "notify_url": "http://127.0.0.1:8000/user/alipay_notify/",
    "return_url": "http://127.0.0.1:8000/user/center/",
    "private_key_path": os.path.join(BASE_DIR, "keys/my_private_key.txt"),
    "public_key_path": os.path.join(BASE_DIR, "keys/alipay_public_key.txt"),
    "debug": True,
}
```

#### å¯†é’¥æ–‡ä»¶
1. ç”ŸæˆRSAå¯†é’¥å¯¹
2. ä¸Šä¼ å…¬é’¥åˆ°æ”¯ä»˜å®å¼€æ”¾å¹³å°
3. ä¸‹è½½æ”¯ä»˜å®å…¬é’¥
4. å°†å¯†é’¥æ–‡ä»¶æ”¾åœ¨ `keys/` ç›®å½•ä¸‹

### 3. æ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
python manage.py makemigrations

# æ‰§è¡Œè¿ç§»
python manage.py migrate

# åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python manage.py runserver

# è®¿é—®åº”ç”¨
http://127.0.0.1:8000
```

---

## ğŸ’° æ”¯ä»˜åŠŸèƒ½è¯¦è§£

### æ”¯ä»˜æµç¨‹

1. **ç”¨æˆ·å……å€¼**ï¼šåœ¨ç”¨æˆ·ä¸­å¿ƒç‚¹å‡»"å……å€¼"æŒ‰é’®
2. **ç”Ÿæˆè®¢å•**ï¼šç³»ç»Ÿåˆ›å»ºå……å€¼è®¢å•è®°å½•
3. **è°ƒç”¨æ”¯ä»˜å®**ï¼šç”Ÿæˆæ”¯ä»˜äºŒç»´ç å’Œç½‘é¡µæ”¯ä»˜é“¾æ¥
4. **ç”¨æˆ·æ”¯ä»˜**ï¼šæ‰«ç æˆ–ç½‘é¡µæ”¯ä»˜
5. **å¼‚æ­¥é€šçŸ¥**ï¼šæ”¯ä»˜å®å›è°ƒæ›´æ–°è®¢å•çŠ¶æ€
6. **ç§¯åˆ†åˆ°è´¦**ï¼šè‡ªåŠ¨å¢åŠ ç”¨æˆ·ç§¯åˆ†

### æ”¯ä»˜æ–¹å¼

#### æ‰«ç æ”¯ä»˜
- ç”ŸæˆäºŒç»´ç ä¾›æ‰‹æœºæ”¯ä»˜å®APPæ‰«ç 
- æ”¯æŒå½“é¢ä»˜åŠŸèƒ½
- å®æ—¶è½®è¯¢æ”¯ä»˜çŠ¶æ€

#### ç½‘é¡µæ”¯ä»˜
- è·³è½¬åˆ°æ”¯ä»˜å®ç½‘é¡µæ”¯ä»˜é¡µé¢
- é€‚åˆç”µè„‘ç«¯ç”¨æˆ·
- æ”¯ä»˜å®Œæˆåè‡ªåŠ¨è·³è½¬å›å¹³å°

### è®¢å•çŠ¶æ€

| çŠ¶æ€ç  | çŠ¶æ€åç§° | æè¿° |
|--------|----------|------|
| 0 | å¾…æ”¯ä»˜ | è®¢å•å·²åˆ›å»ºï¼Œç­‰å¾…æ”¯ä»˜ |
| 1 | å·²æ”¯ä»˜ | æ”¯ä»˜æˆåŠŸï¼Œç§¯åˆ†å·²åˆ°è´¦ |
| 2 | å·²å…³é—­ | è®¢å•å·²å–æ¶ˆæˆ–è¶…æ—¶ |

---

## ğŸ¨ ç•Œé¢è®¾è®¡

### ç™»å½•æ³¨å†Œé¡µé¢
- ç°ä»£åŒ–æ¸å˜èƒŒæ™¯
- æ¯›ç»ç’ƒå¡ç‰‡æ•ˆæœ
- å“åº”å¼è®¾è®¡
- å¯†ç å¼ºåº¦æ£€æµ‹

### ç”¨æˆ·ä¸­å¿ƒ
- ä¸ªäººä¿¡æ¯å±•ç¤º
- ç§¯åˆ†ä½™é¢æ˜¾ç¤º
- å……å€¼åŠŸèƒ½å…¥å£
- èœå•å¯¼èˆª

### å……å€¼é¡µé¢
- ç¾è§‚çš„æ”¯ä»˜ç•Œé¢
- äºŒç»´ç å±•ç¤º
- æ”¯ä»˜çŠ¶æ€æç¤º
- æˆåŠŸåŠ¨ç”»æ•ˆæœ

---

## ğŸ”§ å¼€å‘æŒ‡å—

### ç¯å¢ƒåˆ‡æ¢

```bash
# åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
export ALIPAY_ENV=prod

# åˆ‡æ¢åˆ°æ²™ç®±ç¯å¢ƒ
export ALIPAY_ENV=sandbox
```

### æµ‹è¯•æ”¯ä»˜

```bash
# ä½¿ç”¨æ¨¡æ‹Ÿæ”¯ä»˜ï¼ˆè·³è¿‡æ”¯ä»˜å®ï¼‰
POST /user/simulate_pay/
{
    "oid": "è®¢å•ID"
}

# ä½¿ç”¨æµ‹è¯•æ”¯ä»˜ï¼ˆç›´æ¥åˆ°è´¦ï¼‰
POST /user/test_pay/
```

### è°ƒè¯•å·¥å…·

```python
# æŸ¥çœ‹å½“å‰æ”¯ä»˜å®é…ç½®
python -c "
from django.conf import settings
print('ç¯å¢ƒ:', settings.ALIPAY_ENV)
print('AppID:', settings.ALIPAY['appid'])
print('ç½‘å…³:', settings.ALIPAY['gateway'])
"
```

---

## ğŸ“± APIæ¥å£

### ç”¨æˆ·ç›¸å…³
- `POST /user/register/` - ç”¨æˆ·æ³¨å†Œ
- `POST /user/login/` - ç”¨æˆ·ç™»å½•
- `GET /user/center/` - ç”¨æˆ·ä¸­å¿ƒ
- `GET /user/logout/` - ç”¨æˆ·ç™»å‡º

### æ”¯ä»˜ç›¸å…³
- `GET /user/recharge/` - å……å€¼é¡µé¢
- `GET /user/alipay_qrcode/` - è·å–æ”¯ä»˜äºŒç»´ç 
- `GET /user/query_order/<oid>/` - æŸ¥è¯¢è®¢å•çŠ¶æ€
- `POST /user/alipay_notify/` - æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥

### æµ‹è¯•æ¥å£
- `POST /user/simulate_pay/` - æ¨¡æ‹Ÿæ”¯ä»˜
- `POST /user/test_pay/` - æµ‹è¯•æ”¯ä»˜

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **ä¿®æ”¹settings.py**
```python
# ç”Ÿäº§ç¯å¢ƒé…ç½®
PROD_ALIPAY = {
    "appid": "ä½ çš„æ­£å¼APPID",
    "gateway": "https://openapi.alipay.com/gateway.do",
    "notify_url": "https://yourdomain.com/user/alipay_notify/",
    "return_url": "https://yourdomain.com/user/center/",
    "private_key_path": os.path.join(BASE_DIR, "keys/prod_app_private_key.pem"),
    "public_key_path": os.path.join(BASE_DIR, "keys/prod_alipay_public_key.pem"),
    "debug": False,
}
```

2. **è®¾ç½®ç¯å¢ƒå˜é‡**
```bash
export ALIPAY_ENV=prod
```

3. **é…ç½®HTTPS**
- ç¡®ä¿åŸŸåæ”¯æŒHTTPS
- é…ç½®SSLè¯ä¹¦
- æ›´æ–°æ”¯ä»˜å®å›è°ƒåœ°å€

### æœåŠ¡å™¨éƒ¨ç½²

```bash
# å®‰è£…ä¾èµ–
pip install gunicorn

# å¯åŠ¨æœåŠ¡
gunicorn GoodShop.wsgi:application --bind 0.0.0.0:8000

# ä½¿ç”¨Nginxåå‘ä»£ç†
# é…ç½®é™æ€æ–‡ä»¶æœåŠ¡
# é…ç½®HTTPSè¯ä¹¦
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯†é’¥æ–‡ä»¶é”™è¯¯**
   - æ£€æŸ¥å¯†é’¥æ–‡ä»¶è·¯å¾„
   - ç¡®è®¤å¯†é’¥æ ¼å¼æ­£ç¡®
   - éªŒè¯å…¬é’¥å·²ä¸Šä¼ åˆ°æ”¯ä»˜å®

2. **æ”¯ä»˜å›è°ƒå¤±è´¥**
   - æ£€æŸ¥notify_urlæ˜¯å¦å¯è®¿é—®
   - ç¡®è®¤HTTPSé…ç½®æ­£ç¡®
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

3. **äºŒç»´ç æ˜¾ç¤ºå¼‚å¸¸**
   - æ£€æŸ¥qrcodejsåº“æ˜¯å¦åŠ è½½
   - ç¡®è®¤CDNè¿æ¥æ­£å¸¸
   - éªŒè¯äºŒç»´ç æ•°æ®æ ¼å¼

### è°ƒè¯•æŠ€å·§

```python
# å¼€å¯è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æŸ¥çœ‹æ”¯ä»˜å®è¿”å›ç»“æœ
print(f"æ”¯ä»˜å®è¿”å›: {result}")

# éªŒè¯ç­¾å
from .utils.alipay_utils import verify_notify
success = verify_notify(data, sign)
print(f"ç­¾åéªŒè¯: {success}")
```

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- ğŸ“§ é‚®ç®±ï¼šsupport@example.com
- ğŸ› é—®é¢˜åé¦ˆï¼š[GitHub Issues](https://github.com/your-repo/issues)
- ğŸ“– æ–‡æ¡£ï¼š[é¡¹ç›®Wiki](https://github.com/your-repo/wiki)

---

**ğŸ‰ æ„Ÿè°¢ä½¿ç”¨AIç”Ÿå›¾å¹³å°ï¼**
